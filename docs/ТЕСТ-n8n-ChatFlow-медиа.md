# Тест: умеет ли n8n + ChatFlow отправлять голос и фото

Проверяем на **отдельном** проекте, чтобы не трогать текущий CRM.  
Цель — убедиться, что n8n через ChatFlow может слать медиа в WhatsApp.

---

## Шаг 1. Где взять n8n

Варианты:

- **n8n.cloud** — облачный n8n (есть бесплатный тариф)
- **Свой сервер** — Docker/установка n8n на VPS
- **Локально** — `npx n8n` на своём компьютере

Выбери один способ и запусти n8n. Открой его в браузере (обычно http://localhost:5678).

---

## Шаг 2. Подключить WhatsApp через ChatFlow

1. Зайди на **chatflow.kz**.
2. Войди в аккаунт (или создай).
3. В личном кабинете найди раздел **подключения WhatsApp к n8n**.
4. Выполни инструкции ChatFlow: сканируй QR, настрой интеграцию с n8n.
5. В итоге в n8n должна появиться нода/триггер, который получает входящие сообщения WhatsApp.

Если ChatFlow даёт **URL вебхука** — скопируй его, он понадобится в n8n.

---

## Шаг 3. Создать новый воркфлоу в n8n

1. В n8n нажми **New Workflow** (новый воркфлоу).
2. Название: например, «Тест медиа».

---

## Шаг 4. Добавить триггер (входящее сообщение)

1. Добавь узел **ChatFlow WhatsApp Trigger** (или как он называется в твоём n8n — «Входящее сообщение WhatsApp»).
2. Настрой подключение к ChatFlow (токен, инстанс — как в инструкции ChatFlow).
3. Этот узел будет срабатывать, когда кто-то пишет в WhatsApp.

---

## Шаг 5. Добавить узел «Отправить медиа»

1. Добавь узел **отправки сообщения в WhatsApp** (ChatFlow WhatsApp / Send Message / что-то похожее).
2. В настройках узла найди поле **«Media»**, **«URL»**, **«Image»**, **«File»** или похожее — то, где указывается ссылка на файл.
3. В это поле вставь **публичную ссылку на картинку**, например:
   ```
   https://buildcrm-api.onrender.com/uploads/1770947800345-794d71ea58a84f6a.png
   ```
   (это реальное фото из твоего CRM, оно доступно по ссылке)
4. Укажи получателя — того же, кто написал (номер из триггера). В ChatFlow/n8n это обычно переменная вроде `{{ $json.from }}` или `{{ $json.remoteJid }}`.

---

## Шаг 6. Сохранить и включить воркфлоу

1. Сохрани воркфлоу (Save).
2. Включи его (toggle «Active» в правом верхнем углу).

---

## Шаг 7. Провести тест

1. Открой WhatsApp на телефоне.
2. Напиши боту любое сообщение (например «Привет»).
3. Сработает триггер → n8n отправит картинку по URL.

**Проверь:**
- пришла ли в чат **картинка** как обычное медиа-сообщение;
- или пришёл только текст/ссылка.

---

## Что это значит

| Результат | Вывод |
|-----------|--------|
| **Картинка пришла** | n8n + ChatFlow умеют слать медиа. Имеет смысл переносить AI-менеджера в n8n. |
| **Картинка не пришла** (только текст или ничего) | n8n использует тот же send-media, что и мы, — он не работает. n8n медиа не решит. |

---

## Если в n8n нет поля «URL» для медиа

Если в узле отправки WhatsApp **нет** поля для URL картинки/голоса, то:

- либо ChatFlow-нода n8n не умеет отправлять медиа;
- либо это делается другим способом (например, загрузка файла).

Тогда нужно смотреть документацию ChatFlow по n8n или писать в их поддержку.

---

## Кратко

1. Запусти n8n (отдельно от CRM).
2. Подключи WhatsApp через ChatFlow.
3. Воркфлоу: входящее сообщение → отправить картинку по URL.
4. Напиши боту и проверь, пришла ли картинка.
5. Если пришла — n8n подходит для голоса и фото. Если нет — проблема в ChatFlow, n8n не поможет.

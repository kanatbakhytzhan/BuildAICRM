# –§–æ—Ç–æ/–≥–æ–ª–æ—Å –ø—Ä–∏—Ö–æ–¥–∏—Ç –∫–∞–∫ —Ç–µ–∫—Å—Ç, –∞ –Ω–µ –∫–∞–∫ –º–µ–¥–∏–∞

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ñ–æ—Ç–æ –∏ –≥–æ–ª–æ—Å–æ–≤—ã–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è **—Ç–µ–∫—Å—Ç–æ–≤–æ–π —Å—Å—ã–ª–∫–æ–π** (¬´üñº –§–æ—Ç–æ: https://...¬ª) –≤–º–µ—Å—Ç–æ –æ–±—ã—á–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–ª–∏ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ WhatsApp.

## –ü—Ä–∏—á–∏–Ω–∞

–ù–∞—à API –≤—ã–∑—ã–≤–∞–µ—Ç ChatFlow –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –º–µ–¥–∏–∞. –ï—Å–ª–∏ ChatFlow –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É –∏–ª–∏ `success: false`, –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç ‚Äî –æ—Ç–ø—Ä–∞–≤–∫—É —Å—Å—ã–ª–∫–∏ —Ç–µ–∫—Å—Ç–æ–º.

## –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ –≤ –∫–æ–¥–µ

1. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî –≤ –ª–æ–≥–∞—Ö API –ø–∏—à–µ—Ç—Å—è —Ç–æ—á–Ω—ã–π –æ—Ç–≤–µ—Ç ChatFlow: `status`, `success`, `message`, –Ω–∞—á–∞–ª–æ `response`. –°–º–æ—Ç—Ä–∏ Render ‚Üí buildcrm-api ‚Üí Logs.

2. **–î–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏**:
   - —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º `send-image` (GET) –∏ `send-audio` (GET);
   - –ø—Ä–∏ –Ω–µ—É–¥–∞—á–µ ‚Äî –ø—Ä–æ–±—É–µ–º `send-media` (POST).

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏** ‚Äî –ø—Ä–∏ –æ—à–∏–±–∫–µ –≤—ã —É–≤–∏–¥–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏:
   - `sendMediaToLead FAIL: ChatFlow send-image status=... success=... message=...`
   - `sendMediaToLead send-media POST failed ...`

## –ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å

### 1. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ Render

1. –û—Ç–∫—Ä–æ–π—Ç–µ [dashboard.render.com](https://dashboard.render.com) ‚Üí buildcrm-api ‚Üí Logs.
2. –ù–∞–π–¥–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏ —Å `sendMediaToLead FAIL` –∏–ª–∏ `send-media POST failed`.
3. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è `status`, `success`, `message`, `response`.

### 2. –£–±–µ–¥–∏—Ç—å—Å—è –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö

- **chatflowApiToken** ‚Äî API-—Ç–æ–∫–µ–Ω –∏–∑ ChatFlow.
- **chatflowInstanceId** ‚Äî ID –∏–Ω—Å—Ç–∞–Ω—Å–∞ WhatsApp (–∏–ª–∏ `instance_id` –∏–∑ ChatFlow).
- –í CRM ‚Üí –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí AI/WhatsApp —ç—Ç–∏ –ø–æ–ª—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–¥–∞–Ω—ã.

### 3. –ù–∞–ø–∏—Å–∞—Ç—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É ChatFlow

–°–ø—Ä–æ—Å–∏—Ç–µ —É –Ω–∏—Ö:

> –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ª–∏ API –æ—Ç–ø—Ä–∞–≤–∫—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ URL? –ö–∞–∫–æ–π —ç–Ω–¥–ø–æ–∏–Ω—Ç –∏ —Ñ–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞: GET `send-image?imageurl=URL` –∏–ª–∏ POST `send-media` —Å body `{ url, type: "image" }`?  
> –ú—ã –ø–æ–ª—É—á–∞–µ–º [–≤—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ `message` –∏–ª–∏ `response` –∏–∑ –ª–æ–≥–æ–≤].

### 4. –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ ‚Äî –º–µ–¥–∏–∞ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä ChatFlow

–ï—Å–ª–∏ API ChatFlow –Ω–µ —É–º–µ–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ñ–æ—Ç–æ/–≥–æ–ª–æ—Å –ø–æ URL, –º–æ–∂–Ω–æ:

1. –í –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ ChatFlow –¥–æ–±–∞–≤–∏—Ç—å —É–∑–ª—ã ¬´–ê—É–¥–∏–æ—Å–æ–æ–±—â–µ–Ω–∏–µ¬ª –∏ ¬´–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ¬ª.
2. –ü–æ–¥—Å—Ç–∞–≤–∏—Ç—å –≤ –Ω–∏—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ –æ—Ç–≤–µ—Ç–∞ –≤–µ–±—Ö—É–∫–∞: `{{body.welcomeVoiceUrl}}`, `{{body.welcomeImageUrls.0}}`.
3. –£–∑–ª—ã –¥–æ–ª–∂–Ω—ã —É–º–µ—Ç—å –ø—Ä–∏–Ω–∏–º–∞—Ç—å URL (–µ—Å–ª–∏ –Ω–µ—Ç ‚Äî —É—Ç–æ—á–Ω–∏—Ç—å —É ChatFlow).

–ü–æ–¥—Ä–æ–±–Ω–µ–µ: [CHATFLOW-MEDIA-NODES.md](CHATFLOW-MEDIA-NODES.md).

## –ü–æ—á–µ–º—É –≥–æ–ª–æ—Å–æ–≤—ã–µ —É—Ö–æ–¥—è—Ç, –∞ —Ñ–æ—Ç–æ ‚Äî –Ω–µ—Ç

- **send-audio** (GET) —É ChatFlow —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Äî –≥–æ–ª–æ—Å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è.
- **send-image** (GET) –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `success: false`, —Å–æ–æ–±—â–µ–Ω–∏–µ ¬´Parameter [token, instance_id, caption, jid, imageurl] are required!¬ª ‚Äî –ø—Ä–∏ —ç—Ç–æ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –∑–∞–ø—Ä–æ—Å–µ –µ—Å—Ç—å. –ß–∞—Å—Ç–∞—è –ø—Ä–∏—á–∏–Ω–∞: **–æ–±—Ä–µ–∑–∫–∞ –¥–ª–∏–Ω–Ω–æ–≥–æ URL** (–ø—Ä–æ–∫—Å–∏/–ª–∏–º–∏—Ç –¥–ª–∏–Ω—ã query), –∏–∑‚Äë–∑–∞ —á–µ–≥–æ —Å–µ—Ä–≤–µ—Ä –Ω–µ –≤–∏–¥–∏—Ç —á–∞—Å—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.
- POST –Ω–∞ `/send-image` –∏ `/send-media` —É ChatFlow **–Ω–µ—Ç** (Cannot POST).

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ –≤ –∫–æ–¥–µ:** –¥–ª—è send-image —è–≤–Ω–æ –∫–æ–¥–∏—Ä—É–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–µ–ø—É—Å—Ç–æ–π caption (–ø—Ä–æ–±–µ–ª, –µ—Å–ª–∏ –ø–æ–¥–ø–∏—Å—å –ø—É—Å—Ç–∞—è). –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –æ—Å—Ç–∞—ë—Ç—Å—è ‚Äî —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ ChatFlow (–¥–ª–∏–Ω–∞ GET –∏–ª–∏ –±–∞–≥). –ù–∞–ø–∏—à–∏ –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É ChatFlow: ¬´send-audio –ø–æ GET —Ä–∞–±–æ—Ç–∞–µ—Ç, send-image –ø–æ GET –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç "parameters required" –ø—Ä–∏ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö; –µ—Å—Ç—å –ª–∏ –ª–∏–º–∏—Ç –¥–ª–∏–Ω—ã URL –∏–ª–∏ –Ω—É–∂–µ–Ω POST –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π?¬ª

## –í–Ω–µ—à–Ω–∏–µ URL

–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–Ω–µ—à–Ω–∏–π URL (–Ω–∞–ø—Ä–∏–º–µ—Ä, Imgur), –æ–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å:

- –ø–æ –ø—Ä–æ—Ç–æ–∫–æ–ª—É HTTPS;
- –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (–¥–æ—Å—Ç—É–ø–µ–Ω –±–µ–∑ –ª–æ–≥–∏–Ω–∞);
- —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º Content-Type (image/jpeg, image/png –∏ —Ç.–ø.) ‚Äî –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Ö–æ—Å—Ç–∏–Ω–≥–∏ –æ—Ç–¥–∞—é—Ç HTML –≤–º–µ—Å—Ç–æ –∫–∞—Ä—Ç–∏–Ω–∫–∏.

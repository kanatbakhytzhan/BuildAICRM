# Почему ссылки на фото/голосовые дают 404

## Проблема

При открытии ссылки вида  
`https://buildcrm-api.onrender.com/uploads/1771167639922-7a4922bc99e5f92e.png`  
возвращается ошибка 404.

## Причина

На Render используется **эфемерная файловая система**: при перезапуске или деплое все файлы в каталоге приложения удаляются. Файлы в `uploads/` не сохраняются между перезапусками.

---

## Решение: Persistent Disk на Render

Нужно подключить **Persistent Disk** к сервису API и использовать его для хранения uploads.

### Шаги

1. Зайдите в [Render Dashboard](https://dashboard.render.com/) → выберите сервис **buildcrm-api**.

2. Откройте вкладку **Disks** (диски).

3. Нажмите **Add disk**.

4. Укажите:
   - **Mount path:** `/app/uploads`
   - **Size:** 1 GB (или больше, если нужно).

5. Сохраните. Render перезапустит сервис, диск смонтируется.

6. Убедитесь, что в Dockerfile `WORKDIR` — `/app`. Тогда путь `process.cwd() + '/uploads'` будет `/app/uploads`, и файлы будут попадать на диск.

> **Важно:** Persistent Disk доступен только на **платном** тарифе Render. На бесплатном тарифе диски не поддерживаются.

---

## Решение: Cloudinary (бесплатно, встроено)

CRM поддерживает **Cloudinary** — бесплатное облачное хранилище. Загрузки из CRM и голосовые из WhatsApp автоматически сохраняются в Cloudinary и получают постоянные URL.

### Шаги

1. Зарегистрируйтесь на [cloudinary.com](https://cloudinary.com) (бесплатный аккаунт).

2. Dashboard → **API Keys** — скопируйте:
   - Cloud name  
   - API Key  
   - API Secret  

3. В Render → buildcrm-api → **Environment** добавьте:
   - `CLOUDINARY_CLOUD_NAME`  
   - `CLOUDINARY_API_KEY`  
   - `CLOUDINARY_API_SECRET`  

4. Перезапустите сервис. Новые загрузки будут попадать в Cloudinary, ссылки перестанут давать 404.

---

## Альтернатива: внешние URL вручную

Если Cloudinary не использовать:

1. **Внешние URL для приветственных медиа**  
   Вместо загрузки через CRM используйте стабильные ссылки:
   - [Imgur](https://imgur.com) — фото
   - [Cloudinary](https://cloudinary.com) — фото и аудио (загрузка через их сайт)
   - Свой CDN или хостинг.

2. В настройках темы (Голосовое приветствие, Главное фото) укажите эти внешние URL.

---

## Кратко

| Вариант | Плюсы | Минусы |
|--------|-------|--------|
| **Cloudinary (env vars)** | Бесплатно, встроено, загрузки из CRM работают | Нужен аккаунт Cloudinary |
| **Persistent Disk** | Всё хранится на Render | Только платный тариф Render |
| **Внешние URL вручную** | Работает | Медиа нужно размещать вручную |
